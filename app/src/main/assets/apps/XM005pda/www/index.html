<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>沈阳上发汽车零部件有限公司框架主页</title>
    <script src="js/mui.min.js"></script>
    <link href="css/mui.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="fonts/iconfont.css" />
    <style>
		.mui-bar-tab .mui-tab-item.mui-active {color: #31ff00 !important;}
		nav.mui-bar.mui-bar-tab{box-shadow:none;border-top:1px solid #d2d1d6;background:url(img/bg.jpg) 0 345%;background-size: cover;}
		span.mui-badge.mui-badge-red{top:5px;position:absolute;right:16px;width:17px;height:17px;border-radius:50%;padding:0;font-size:12px!important;z-index:9999;line-height:18px}
		a.mui-tab-item{position:relative;color: #dadada !important;}
		a.mui-tab-item.on:after{content:' ';width:2px;height:2px;padding:3px;position:absolute;top:2px;background:red;border-radius:50%;right:13px}
		a.mui-tab-item[number-html="my.html"] span.mui-badge{width:9px;height:9px}
    </style>
    <script type="text/javascript" charset="utf-8">
      		mui.init({swipeBack: false});
    </script>
</head>
<body>
		        <nav class="mui-bar mui-bar-tab">
		            <a data-index="0" class="mui-tab-item mui-active">
		                <span class="mui-icon iconfont icon-shouye"></span>
		                <span class="mui-tab-label">物料</span>
		            </a>
		            <a data-index="1" number-html="operation.html" class="mui-tab-item">
		                <span class="mui-icon iconfont icon-banshou"></span>
		                <span class="mui-tab-label">订单管理</span>
		            </a>
		            <a data-index="-1" class="mui-tab-item">
		                <span class="mui-icon iconfont icon-saomiao"></span>
		                <span class="mui-tab-label">扫一扫</span>
		            </a>
		            <!--<a data-index="2" number-html="news.html" class="mui-tab-item">
		                <span class="mui-icon iconfont icon-xiaoxi"></span>
		                <span class="mui-tab-label">消息</span>
		            </a>-->
		            <a data-index="3" number-html="my.html" class="mui-tab-item">
		                <span class="mui-icon iconfont icon-wode1"></span>
		                <span class="mui-tab-label">我的</span>
		            </a>
		        </nav>
    <script src="js/mtool.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		var pages= ['main.html','operation.html','news.html','my.html'],
			vies=[],active=0,TM={};//TM:保存点击的时间的值，目的是防止快速连续点击
		mui.plusReady(function(){
			if(!LL.loginInfo){//如果还没有登录，提示去登录
		    	M.go('login.html') ;
		    }
			plus.nativeUI.showWaiting( "加载中..." );
			var  w = M.ws; 
			for(var a = 0,d;d=pages[a] ;a++){
				var sw =plus.webview.create(d, d, {top:0,bottom: '51px'}); ;
				vies.push(sw) ;
				d!='main.html'&&sw.hide();
				w.append(sw); 
			}
			mui.later(function(){
				  plus.nativeUI.closeWaiting();
			},500);
		});
		mui('.mui-bar-tab').on('tap', 'a', function(e,a) {
			!e.detail.nop && M.p();
			var i = this.getAttribute('data-index') ,arr= plus.webview.getDisplayWebview();//获取可见的窗口
			if(i==-1){//如果点击的是扫描
				M.go('saomiao.html',{type:'tTwWcC[lsp-yY',title:'请扫描二维码或条形码'});
				return false ;
			}else{
				for(var a = 0,d;d=arr[a] ;a++){
					var url =d.getURL() ,n = url.indexOf('www'),key=url.substring(n+4,url.length);
					~n && !~pages.indexOf(key) && key!='index.html' && M.hideW(d) ;//如果是合法目录并且是当前不在底层目录，则后退到底层
				}
			    if(active!=i){// 如果两次点击的都是同一个页面，则不做操作
			    	plus.webview.show(vies[i]) ;
			    	plus.webview.hide(vies[active]) ;
			    	active = i ; 
			    }
			    if(!TM[i]||(TM[i] && new Date()-TM[i]>500))vies[i].evalJS('loadNumber()');//最多500毫秒点击一次 
			   	TM[i]=new Date() ;
			}
		});
		document.addEventListener( "netchange",function(){
			M.toast('当前网络状态：'+M.netWork().info,'center') ;
		}) ;
		function loadNumberInfo(h,m){//加载未读数量,如果m==-1就是一个小红点
			var d=mui('a[number-html="'+h+'"]')[0],span = d.querySelector('span.mui-badge.mui-badge-red') ;
			if(m){
				!span && (span='<span class="mui-badge mui-badge-red"></span>'.toDom(),d.appendChild(span));
				span.innerText =!~m?'':m;
			}else{
				span&&span.remove(); 
			}
		}
		document.addEventListener("resume",loadNumber, false );
		mui.back=function(){//返回切换到后台不做退出处理
			if(plus.android){
				var main = plus.android.runtimeMainActivity();
	    		main.moveTaskToBack(false);				
			}
		};
	
	/**
	 * 扫描成功后的回调
	 */
	window.addEventListener('inintFn',function(event){
		var obj = event.detail,key=obj.key ;
			obj =obj.obj;
			switch (obj.type){
				case '['://
				mui.alert('零件号：'+key.partNo+'\n标签号：'+key.mappingTag+'\n数量：【'+key.number+'】','扫描来源华域车身物料标签二维码','确定',function (e) {
				   e.index
				});
					break;
				case 't'://停机报警报表
					mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.ALLSTOP =key ; 
					    M.goT('./stop/alarmRecordReport.html','【'+key+'】报警报表');
					}
				});
					break;
				case 'T'://停机汇总报表
					mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.STOPREPORTFORM =key; 
						M.goT('./stop/stopReportForm.html','【'+key+'】停机汇总报表');
						}
					});
					break;
				case 'w'://物料配送时间统计报表
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.REPORTFORM =key ; 
						 M.goT('./pull/reportFormInfo.html','线旁剩余物料统计报表');
						}
					});
					break;
				case 'W'://线边剩余物料报表编号
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.LINESIDENUMBER =key ; 
						M.goT('./pull/doAllNumber.html','线旁剩余物料统计报表');
						}
					});
					break;
				case 'c'://产量月报
				mui.confirm('统计报表还是差异报表','扫描来源【'+obj.typeInf+'】你想查看',['统计报表','差异报表'],function (e) {
						if(e.index){//查看差异报表
							LL.REPORTHTML2=key; 
							M.goT('./production/reportMonth2.html','【'+key+'】差异报表');
						}else{//查看统计报表
							LL.REPORTHTML2=key; 
							M.goT('./production/reportMonth.html','【'+key+'】统计报表');
						}
					});
					break;
				case 'C'://产量日报
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.reportDayListhtml=key ;
						M.goT('./production/reportDay.html','【'+key+'】');
						}
					});
					break;	
				case 'p'://人员二维码：
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.userqrcode=key ;
						M.go('./production/userinfo.html','【'+key+'】');
						}
					});
					break;
				case 'l'://灯二维码
				scanLight(obj,key) ;
				break ;
				case 's'://工位二维码
				scanStation(obj,key) ;
				break ;
				case '-'://如果扫描到的是TPM点检表。
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.TPMCHECKNOTPMLISTHTML=key ;
						M.goT('./quality/TPMinfo.html',key+'-点检详情');
						}
					});
				break ; 
				case 'y'://人员符合率日报。
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
							LL.reportDayListhtml=key ;
							M.goT('./production/reportDay2.html','【'+obj.key+'】');
						}
					});
				break ; 
				case 'Y'://人员符合率月报
				mui.confirm('是否查看'+key,'扫描来源【'+obj.typeInf+'】',['确认','取消'],function (e) {
					if(!e.index){
						LL.TPMCHECKNOTPMLISTHTML=key ;
						M.goT('./quality/TPMinfo.html',key+'-点检详情');
						}
					});
				break ; 
			}
			M.toast('扫描成功！扫描到的值为==》'+(key.partNo||key)) ;
	});
	
	function scanStation(obj,key){//如果扫描到的是工位二维码，执行
		sendAjax('/basic/selectByStationNo.do',{stationQr:key},function(D){
					plus.nativeUI.actionSheet({
					title:"扫描来源工位【"+D.stationNo+"】你想查看",
					cancel:"取消",
					buttons:[{title:"工位详细信息"},{title:"该工位当前物料"}]
				}, function(e){
					switch (e.index){
						case 1://工位详细信息
						var info =[],lineInfo ;
						function dls(){
							if(info.ld && lineInfo){
								mui.alert('产线：'+D.lineName+'\n开班状态：【'+lineInfo.status+'】\n开班时间：'+(lineInfo.classStartTime||'')+'\n班组长：'+(lineInfo.classLeader||'')+'\n工位：'+D.stationNo+'\n对应人员：'+info.join(','),"工位【"+D.stationNo+"】详情",'确定',function (e) {
								});								
							}
						}
						sendAjax('/class/presentRealTimeAllLine.do',{},function(D2){
							for(var a = 0,d;d=D2[a];a++){
								if(d.lineName==D.lineName){
									lineInfo=d ;
									break ;
								}
							}
							dls();
						})
						sendAjax('/basic/selectBasicPersonMsgAll.do',{page:1,rows:999},function(data){
							for(var a = 0,d,arr=data.rows;d=arr[a];a++){
								if(d.stationNo==D.stationNo){
									info.push(d.post+':'+d.name);
								}
							}
							info.ld=true ;
							dls();
						})
						break;
						case 2://该工位当前物料
						M.goT('pull/list3.html','工位【'+D.stationNo+'】当前物料',{dataurl:'/pull/allstationStock.do',searchData:{stationNo:D.stationNo}});
						break;
					}
				} );
				});
	};
	function scanLight(obj,key){//解析扫描到的为灯二维码
		var info ;
		sendAjax('/oALight/queryOneQualityChangeStutas.do',{lightQr:key},function(data){
			if(data){
				mui.confirm('是否查看该灯的亮灭情况','扫描来源灯二维码',['确认','取消'],function (e) {
					if(!e.index){
						M.goT('pull/list3.html','工位【'+D.stationNo+'】当前物料',{dataurl:'/pull/allstationStock.do',searchData:{stationNo:D.stationNo}});	
					}
				});				
			}else{
				mui.alert('系统不存在该灯二维码','灯二维码错误','确定',function (e) {}) ;
			}
		},true);
	}
	/**
	 * 模拟点击首页
	 */
	window.addEventListener('tapindex',function(event){
		mui.trigger(mui('a[data-index="0"]')[0],'tap',{nop:true}) ;
		mui('a.mui-active')[0].classList.remove('mui-active') ;
		mui('a[data-index="0"]')[0].classList.add('mui-active') ;
	});
	</script>
</body>
</html>